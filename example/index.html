<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
  <link rel="stylesheet" type="text/css" href="./sakura.css" />
  <title>WebUSB STM32 DFU</title>
  <script src="FileSaver.js"></script>
  <script src="../dist/stm32dfu.js"></script>
  <script src="dfu-util.js"></script>
</head>
<body>
<a href="https://github.com/kischang/stm32dfu"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/a6677b08c955af8400f44c6298f40e7d19cc5b2d/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677261795f3664366436642e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"></a>
<p>
  <span id="status"></span>
</p>
<p>
  <label for="vid">Vendor ID (hex):</label>
  <input list="vendor_ids" type="text" name="vid" id="vid" maxlength="6" size="8" pattern="0x[A-Fa-f0-9]{1,4}"/>
  <datalist id="vendor_ids">
    <option value="0x0483">STMicroelectronics STM32 DFU bootloader</option>
  </datalist>
</p>
<p>
  <button id="connect">首先: Connect to Device</button>
</p>
<dialog id="interfaceDialog">
  Your device has multiple DFU interfaces. Select one from the list below:<br/>
  您的设备有多个 DFU 接口， 从下面的列表中选择一项（一般都是第一个）：
  <form id="interfaceForm" method="dialog">
    <button id="selectInterface" type="submit">Select interface</button>
  </form>
</dialog>
<p>
<div id="usbInfo" style="white-space: pre"></div>
<div id="dfuInfo" style="white-space: pre"></div>
</p>
<fieldset>
  <legend>Runtime mode</legend>
  <button id="detach" disabled="true">Detach DFU</button>
</fieldset>
<fieldset>
  <form id="configForm">
    <fieldset>
      <legend>Firmware Download (write to USB device) （固件更新）</legend>
      <label for="transferSize">Transfer Size（传输尺寸）:</label>
      <input type="number" name="transferSize" id="transferSize" value="2048"/>
      <p>
        <input type="file" id="firmwareFile" name="file" disabled="true"/>
      </p>
      <p>
        <button id="download" disabled="true">Download</button>
      </p>
      <div class="log" id="downloadLog"></div>
    </fieldset>
    <fieldset>
      <legend>Firmware Upload (read from USB device)（固件读取）</legend>
      <div id="dfuseFields" hidden="true">
        <label for="dfuseUploadSize">DfuSe Upload Size:</label>
        <input type="number" name="dfuseUploadSize" id="dfuseUploadSize" min="1"/>
      </div>
      <p>
        <button id="upload" disabled="true">Upload</button>
      </p>
      <div class="log" id="uploadLog"></div>
    </fieldset>
  </form>
</fieldset>
<h1>About | 关于</h1>
<p>
  This is a proof-of-concept demo of host <a href="http://wiki.openmoko.org/wiki/USB_DFU">USB DFU</a> drivers in Javascript utilizing the <a href="https://wicg.github.io/webusb/">WebUSB</a> draft standard to implement USB firmware updates from the browser.<br/>
  这是 Javascript 利用 WebUSB 标准从浏览器实现 STM32 DFU 固件更新。<br/>
  本项目基于 <a href="https://github.com/devanlai/webdfu"> webdfu </a>，在这里表示对原项目开发者的感谢！<br/>
  增加对STMicroelectronics STM32的支持，增加对DFU文件的解析。
</p>
<h1>Prerequisites | 先决条件</h1>
<ul>
  <li>
    <p>Chrome 61+</p>
  </li>
  <li>
    <p>STMicroelectronics STM32 DFU class device</p>
  </li>
<ul>
</body>
</html>
